---
layout: post
title: Proxy integration HCX
share-title: HCX and the proxy
subtitle: proxy interaction and HCX
tags: [AVS, HCX, service mesh]
---
{: .box-note}
**Note:** This article won't cover the steps to deploy it, please see the Azure VMware Solution documentation for that.

HCX connector, the component on-prem needs egress internet connectivity.  It needs it in order to activate itself at initial deployment time and after that to provide the option to update itself.  Updating still is a user decision however the recommendation is to keep an eye on this as HCX does release quite a few updates often in short succession.

In order to allow the on-prem proxy to egress out we need a SNAT facility.  This often is arranged by a FW and the default gateway toward it is advertized.  In that case nothing out of the ordinary needs to be done.  Don't need write an article about that.

WHenever there is an on-prem proxy in place however and it needs to be used to egress out that's where usually the fun starts.

Setting it up is done through the HCX admin part of the initial HCX configuration. (Administration/proxy)
Nothing special here as you specify the IP,port,user,password and exclusion list. 

{: .box-warning}
**Warning:** domain joined usernames, forget about those as HCX doesnt support Kerberos/NTLM authentication so you will have to .


Exclusion list, often overlooked but very important.
The proxy will be used for all HTTPS traffic so yes you need to exclude AVS vCenter, NSX-T, ... appliances to avoid them from being pushed out across that happy highway.

Once that is all done, lets verify a few things.  

Here's a very good command to check if the proxy works after you completed that setup. (to be run from the HCX connector)

	_curl --proxy "proxy-ip:proxy-port:"  -kv https://connect.hcx.vmware.com"_
 
As soon as you established that.  e